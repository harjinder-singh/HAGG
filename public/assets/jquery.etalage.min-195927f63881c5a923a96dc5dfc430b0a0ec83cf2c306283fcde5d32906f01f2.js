!function(t){t.fn.etalage=function(a){var e=t.extend({align:"left",thumb_image_width:300,thumb_image_height:400,source_image_width:900,source_image_height:1200,zoom_area_width:600,zoom_area_height:"justify",zoom_area_distance:10,zoom_easing:!0,click_to_zoom:!1,zoom_element:"auto",show_descriptions:!0,description_location:"bottom",description_opacity:.7,small_thumbs:3,smallthumb_inactive_opacity:.4,smallthumb_hide_single:!0,smallthumb_select_on_hover:!1,smallthumbs_position:"bottom",show_begin_end_smallthumb:!0,magnifier_opacity:.5,magnifier_invert:!0,show_icon:!0,icon_offset:20,hide_cursor:!1,show_hint:!1,hint_offset:15,speed:600,autoplay:!0,autoplay_interval:6e3,keyboard:!0,right_to_left:!1,click_callback:function(){return!0},change_callback:function(){return!0}},a);return t.each(this,function(){function a(t){y=y?y-1:0,w=!0;var a,e,i,s,l=o.find(".etalage_smallthumb_first").removeClass("etalage_smallthumb_first"),n=o.find(".etalage_smallthumb_last").removeClass("etalage_smallthumb_last");"left"===t?(a=l.prev().addClass("etalage_smallthumb_first"),e=n.prev().addClass("etalage_smallthumb_last"),i=l):(a=l.next().addClass("etalage_smallthumb_first"),e=n.next().addClass("etalage_smallthumb_last"),i=n),y?"left"===t?a.trigger("click"):e.trigger("click"):(s="vert"===W?a.position().top:a.position().left,Qt(s,a,e,i))}function i(t){w=!0;var a,e,i;o.find(".etalage_smallthumb_first").removeClass("etalage_smallthumb_first"),o.find(".etalage_smallthumb_last").removeClass("etalage_smallthumb_last");"end"===t?(a=P.eq(U-V).addClass("etalage_smallthumb_first"),e=P.eq(U-1).addClass("etalage_smallthumb_last"),i=e,e.hasClass("etalage_smallthumb_navtostart")&&(i=e.prev())):(a=P.eq(0).addClass("etalage_smallthumb_first"),e=P.eq(V-1).addClass("etalage_smallthumb_last"),i=a,a.hasClass("etalage_smallthumb_navtoend")&&(i=a.next()));var s="vert"===W?a.position().top:a.position().left;Qt(s,a,e,i)}function s(){i("start")}function l(){i("end")}var o=t(this);if(o.is("ul")&&o.children("li").length&&o.find("img.etalage_source_image").length){var n,r,h,c,_,m,g,d,u,p,f=o.attr("id"),b=Math.floor(.7*e.speed),v=Math.round(e.speed/100),w=!1,y=0,I=!1,k=!0,C=!1,T=0,z=0,R=0,q=0,L=0,W="hori";void 0!==f&&f||(f="[no id]"),"left"!==e.smallthumbs_position&&"right"!==e.smallthumbs_position||(W="vert"),"object"==typeof t.browser&&t.browser.msie&&t.browser.version<9&&(k=!1,t.browser.version<7&&(I=!0)),o.addClass("etalage").show();var M=o.children("li").addClass("etalage_thumb");M.first().show().addClass("etalage_thumb_active");var x=M.length,j=e.autoplay;x<2&&(j=!1),"right"===e.align&&o.addClass("etalage_right"),t.each(M,function(a){a+=1;var e=t(this),i=e.find(".etalage_thumb_image").removeAttr("alt").show(),s=e.find(".etalage_source_image"),l=e.find("a");e.data("id",a).addClass("thumb_"+a),!i.length&&s.length?e.prepend('<img class="etalage_thumb_image" src="'+s.attr("src")+'" />'):i.length||s.length||e.remove(),l.length&&e.find(".etalage_thumb_image").data("anchor",l.attr("href"))});var B=M.find(".etalage_thumb_image").css({width:e.thumb_image_width,height:e.thumb_image_height}).show();t.each(B,function(){t(this).data("src",this.src)});var A=t('<li class="etalage_magnifier"><div><img /></div></li>').appendTo(o),H=A.children("div"),O=H.children("img"),Q=t('<li class="etalage_icon">&nbsp;</li>').appendTo(o);e.show_icon&&Q.show();var X;e.show_hint&&(X=t('<li class="etalage_hint">&nbsp;</li>').appendTo(o).show());var Y,D=e.zoom_element;"auto"!==D&&D&&t(D).length?Y=t(D).addClass("etalage_zoom_area").html('<div><img class="etalage_zoom_img" /></div>'):(D="auto",Y=t('<li class="etalage_zoom_area"><div><img class="etalage_zoom_img" /></div></li>').appendTo(o));var E,F=Y.children("div");k&&(E=t('<img class="etalage_zoom_preview" />').css({width:e.source_image_width,height:e.source_image_height,opacity:.3}).prependTo(F).show());var G,J=F.children(".etalage_zoom_img").css({width:e.source_image_width,height:e.source_image_height});e.show_descriptions&&(G=t('<div class="etalage_description'+(e.right_to_left?" rtl":"")+'"></div>').prependTo(Y));var K,N,P,S,U,V=e.small_thumbs;(x>1||!e.smallthumb_hide_single)&&(K=t('<li class="etalage_small_thumbs"><ul></ul></li>').appendTo(o),N=K.children("ul"),t.each(B,function(){var a=t(this);h=a.data("src"),c=a.parents(".etalage_thumb").data("id"),t('<li><img class="etalage_small_thumb" src="'+h+'" /></li>').data("thumb_id",c).appendTo(N)}),P=N.children("li").css({opacity:e.smallthumb_inactive_opacity}),V<3&&(V=3),x>V?(e.show_begin_end_smallthumb?(h=B.eq(x-1).data("src"),c=M.eq(x-1).data("id"),t('<li class="etalage_smallthumb_first etalage_smallthumb_navtoend"><img class="etalage_small_thumb" src="'+h+'" /></li>').data("src",h).data("thumb_id",c).css({opacity:e.smallthumb_inactive_opacity}).prependTo(N),h=B.eq(0).data("src"),c=M.eq(0).data("id"),t('<li class="etalage_smallthumb_navtostart"><img class="etalage_small_thumb" src="'+h+'" /></li>').data("src",h).data("thumb_id",c).css({opacity:e.smallthumb_inactive_opacity}).appendTo(N),P=N.children("li"),P.eq(1).addClass("etalage_smallthumb_active").css({opacity:1})):P.eq(0).addClass("etalage_smallthumb_first etalage_smallthumb_active").css({opacity:1}),P.eq(V-1).addClass("etalage_smallthumb_last")):P.eq(0).addClass("etalage_smallthumb_active").css({opacity:1}),t.each(P,function(a){t(this).data("id",a+1)}),S=P.children("img"),U=P.length,"vert"===W&&P.addClass("vertical")),_=e.magnifier_invert?1:e.magnifier_opacity;var Z=parseInt(M.css("borderLeftWidth"),10)+parseInt(M.css("borderRightWidth"),10)+parseInt(B.css("borderLeftWidth"),10)+parseInt(B.css("borderRightWidth"),10),$=parseInt(M.css("marginLeft"),10)+parseInt(M.css("marginRight"),10),tt=parseInt(M.css("paddingLeft"),10)+parseInt(M.css("paddingRight"),10)+parseInt(B.css("marginLeft"),10)+parseInt(B.css("marginRight"),10)+parseInt(B.css("paddingLeft"),10)+parseInt(B.css("paddingRight"),10),at=e.thumb_image_width+Z+$+tt,et=e.thumb_image_height+Z+$+tt,it=0,st=0,lt=0,ot=0,nt=0,rt=0,ht=0;(x>1||!e.smallthumb_hide_single)&&(it=parseInt(P.css("borderLeftWidth"),10)+parseInt(P.css("borderRightWidth"),10)+parseInt(S.css("borderLeftWidth"),10)+parseInt(S.css("borderRightWidth"),10),st=parseInt(P.css("marginTop"),10),lt=parseInt(P.css("paddingLeft"),10)+parseInt(P.css("paddingRight"),10)+parseInt(S.css("marginLeft"),10)+parseInt(S.css("marginRight"),10)+parseInt(S.css("paddingLeft"),10)+parseInt(S.css("paddingRight"),10),"vert"===W?(nt=Math.round((et-(V-1)*st)/V)-(it+lt),ot=Math.round(e.thumb_image_width*nt/e.thumb_image_height),rt=ot+it+lt,ht=nt+it+lt):(ot=Math.round((at-(V-1)*st)/V)-(it+lt),nt=Math.round(e.thumb_image_height*ot/e.thumb_image_width),rt=ot+it+lt,ht=nt+it+lt));var ct,_t,mt=parseInt(Y.css("borderTopWidth"),10),gt=parseInt(e.zoom_area_distance,10),dt=parseInt(Y.css("paddingTop"),10);ct=e.zoom_area_width-2*mt-2*dt>e.source_image_width?e.source_image_width:e.zoom_area_width-2*mt-2*dt,_t="justify"===e.zoom_area_height?et+st+ht-2*mt-2*dt:e.zoom_area_height-2*mt-2*dt,_t>e.source_image_height&&(_t=e.source_image_height);var ut,pt,ft,bt;e.show_descriptions&&(ut=parseInt(G.css("borderLeftWidth"),10)+parseInt(G.css("borderRightWidth"),10),pt=parseInt(G.css("marginLeft"),10)+parseInt(G.css("marginRight"),10),ft=parseInt(G.css("paddingLeft"),10)+parseInt(G.css("paddingRight"),10),bt=ct-ut-pt-ft);var vt;I&&(vt=t('<iframe marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="javascript:\'<html></html>\'"></iframe>').css({position:"absolute",zIndex:1}).prependTo(Y));var wt=parseInt(A.css("borderTopWidth"),10),yt=parseInt(M.css("borderTopWidth"),10)+parseInt(M.css("marginTop"),10)+parseInt(M.css("paddingTop"),10)+parseInt(B.css("borderTopWidth"),10)+parseInt(B.css("marginTop"),10)-wt,It=B.offset().left-o.offset().left-wt;"left"===e.smallthumbs_position?It=It+rt+st:"top"===e.smallthumbs_position&&(yt=yt+ht+st);var kt,Ct,Tt=Math.round(ct*(e.thumb_image_width/e.source_image_width)),zt=Math.round(_t*(e.thumb_image_height/e.source_image_height)),Rt=yt+e.thumb_image_height-zt,qt=It+e.thumb_image_width-Tt,Lt=Math.round(Tt/2),Wt=Math.round(zt/2);if(e.show_hint&&(kt=parseInt(e.hint_offset,10)+parseInt(X.css("marginTop"),10),Ct=parseInt(e.hint_offset,10)+parseInt(X.css("marginRight"),10),"right"===e.smallthumbs_position&&(Ct=Ct-rt-st)),"vert"===W?(d=at+st+rt,o.css({width:d,height:et})):(d=at,o.css({width:d,height:et+st+ht})),e.show_icon&&(p={top:et-Q.outerHeight(!0)-parseInt(e.icon_offset,10),left:parseInt(e.icon_offset,10)},"left"===e.smallthumbs_position?p.left=rt+st+parseInt(e.icon_offset,10):"top"===e.smallthumbs_position&&(p.top+=ht+st),Q.css(p)),e.show_hint&&X.css({margin:0,top:-kt,right:-Ct}),O.css({margin:0,padding:0,width:e.thumb_image_width,height:e.thumb_image_height}),H.css({margin:0,padding:0,width:Tt,height:zt}),p={margin:0,padding:0,left:(qt-It)/2,top:(Rt-yt)/2},"left"===e.smallthumbs_position?p.left="+="+rt+st:"top"===e.smallthumbs_position&&(p.top="+="+ht+st),A.css(p).hide(),F.css({width:ct,height:_t}),p={margin:0,opacity:0},"right"===e.align&&"auto"===D?p.left=-(ct+2*mt+2*dt+gt):"auto"===D&&(p.left=d+gt),Y.css(p).hide(),e.show_descriptions&&(p={width:bt,bottom:dt,left:dt,opacity:e.description_opacity},"top"===e.description_location&&(p.top=dt,p.bottom="auto"),G.css(p).hide()),x>1||!e.smallthumb_hide_single)if("vert"===W?(p={top:0,height:et},"left"===e.smallthumbs_position?M.css({left:rt+st}):p.marginLeft=at+st,K.css(p),N.css({height:ht*U+U*st+100}),S.css({width:ot,height:nt}).attr("height",nt),P.css({margin:0,marginBottom:st})):(p={width:at},"top"===e.smallthumbs_position?M.css({top:ht+st}):p.top=et+st,K.css(p),N.css({width:rt*U+U*st+100}),S.css({width:ot,height:nt}).attr("width",ot),P.css({margin:0,marginRight:st})),(u="vert"===W?ht*V+(V-1)*st-et:rt*V+(V-1)*st-at)>0)for(n=1;n<=U-1;n+=V-1)for(r=1;r<=u;r+=1)"vert"===W?P.eq(n+r-1).css({marginBottom:st-1}):P.eq(n+r-1).css({marginRight:st-1});else if(u<0)for(n=1;n<=U-1;n+=V-1)for(r=1;r<=-u;r+=1)"vert"===W?(P.eq(n+r-1).css({marginBottom:st+1}),N.css({height:parseInt(N.css("height"),10)+1})):(P.eq(n+r-1).css({marginRight:st+1}),N.css({width:parseInt(N.css("width"),10)+1}));e.show_icon&&!e.magnifier_invert&&A.css({background:A.css("background-color")+" "+Q.css("background-image")+" center no-repeat"}),e.hide_cursor&&A.add(Q).css({cursor:"none"}),I&&vt.css({width:F.css("width"),height:F.css("height")});var Mt=M.first().find(".etalage_thumb_image"),xt=M.first().find(".etalage_source_image");e.magnifier_invert&&O.attr("src",Mt.data("src")).show(),k&&E.attr("src",Mt.data("src")),J.attr("src",xt.attr("src")),e.show_descriptions&&(g=xt.attr("title"))&&G.html(g).show();var jt=function(){m&&(clearInterval(m),m=!1)},Bt=function(){m&&jt(),m=setInterval(function(){Dt()},e.autoplay_interval)},At=function(){A.stop().fadeTo(b,_),Q.stop().animate({opacity:0},b),Y.stop().show().animate({opacity:1},b),e.magnifier_invert&&Mt.stop().animate({opacity:e.magnifier_opacity},b),j&&jt()},Ht=function(){A.stop().fadeOut(e.speed),Q.stop().animate({opacity:1},e.speed),Y.stop().animate({opacity:0},e.speed,function(){t(this).hide()}),e.magnifier_invert&&Mt.stop().animate({opacity:1},e.speed,function(){e.click_to_zoom&&(C=!1)}),clearTimeout(T),j&&Bt()},Ot=function(a,i){var s,l,n=o.find(".etalage_smallthumb_active").removeClass("etalage_smallthumb_active");a.addClass("etalage_smallthumb_active"),A.stop().hide(),Y.stop().hide(),i||(w=!0,n.stop(!0,!0).animate({opacity:e.smallthumb_inactive_opacity},b),a.stop(!0,!0).animate({opacity:1},b,function(){w=!1})),o.find(".etalage_thumb_active").removeClass("etalage_thumb_active").stop().animate({opacity:0},e.speed,function(){t(this).hide()}),s=M.filter(".thumb_"+a.data("thumb_id")).addClass("etalage_thumb_active").show().stop().css({opacity:0}).animate({opacity:1},e.speed),Mt=s.find(".etalage_thumb_image"),xt=s.find(".etalage_source_image"),e.magnifier_invert&&O.attr("src",Mt.data("src")),k&&E.attr("src",Mt.data("src")),J.attr("src",xt.attr("src")),e.show_descriptions&&(g=xt.attr("title"),g?G.html(g).show():G.hide()),j&&(jt(),Bt()),l=a.data("id"),x>=V&&l--,Gt(l)},Qt=function(a,i,s,l){t.each(P,function(){var i=t(this),s={opacity:e.smallthumb_inactive_opacity};i.data("id")===l.data("id")&&(s.opacity=1),"vert"===W?s.top="-="+a:s.left="-="+a,i.animate(s,b,"swing",function(){w&&(l.addClass("etalage_smallthumb_active"),w=!1)})}),Ot(l,!0)},Xt=function(){var t=q-z,a=L-R,e=-t/v,i=-a/v;z-=e,R-=i,t<1&&t>-1&&(z=q),a<1&&a>-1&&(R=L),J.css({left:z,top:R}),k&&E.css({left:z,top:R}),(t>1||a>1||t<1||a<1)&&(T=setTimeout(function(){Xt()},25))},Yt=function(){var t;if(e.magnifier_invert&&o.find(".etalage_thumb_active").mouseleave(),e.right_to_left){if(t=o.find(".etalage_smallthumb_active").next(),!t.length)return x>V?s():P.first().trigger("click"),!0}else if(t=o.find(".etalage_smallthumb_active").prev(),!t.length)return x>V?l():P.last().trigger("click"),!0;t.trigger("click")},Dt=function(){var t;if(e.magnifier_invert&&o.find(".etalage_thumb_active").mouseleave(),e.right_to_left){if(t=o.find(".etalage_smallthumb_active").prev(),!t.length)return x>V?l():P.last().trigger("click"),!0}else if(t=o.find(".etalage_smallthumb_active").next(),!t.length)return x>V?s():P.first().trigger("click"),!0;t.trigger("click")},Et=function(t){(x<=V||!e.show_begin_end_smallthumb)&&(t-=1);var a=P.eq(t);if(a.length&&!w){var i,s=o.find(".etalage_smallthumb_active"),l=s.data("id")-1;if(l>t){y=l-t;var n=o.find(".etalage_smallthumb_first"),r=n.data("id");t<r?(i=l-r,y-=i,n.trigger("click")):Ot(a,!1)}else if(l<t){y=t-l;var h=o.find(".etalage_smallthumb_last"),c=h.data("id")-1;t>=c?(i=c-l-1,y-=i,h.trigger("click")):Ot(a,!1)}}};window[f+"_previous"]=function(){Yt()},window[f+"_next"]=function(){Dt()},window[f+"_show"]=function(t){Et(t)};var Ft=function(t){return!!e.click_callback(t,f)&&("function"!=typeof etalage_click_callback||(etalage_click_callback(t,f),!1))},Gt=function(t){e.change_callback(t,f)&&"function"==typeof etalage_change_callback&&etalage_change_callback(t,f)};M.add(A).add(Q).mouseenter(function(){e.show_hint&&X.hide(),e.click_to_zoom&&!C||At()}).mouseleave(function(){Ht()});var Jt=-(e.source_image_width-ct),Kt=-(e.source_image_height-_t);M.add(A).add(Q).mousemove(function(t){var a=Math.round(t.pageX-Mt.offset().left+It),i=Math.round(t.pageY-Mt.offset().top+yt),s=a-Lt,l=i-Wt;if(s<It&&(s=It),s>qt&&(s=qt),l<yt&&(l=yt),l>Rt&&(l=Rt),A.css({left:s,top:l}),e.magnifier_invert){var o=s-It,n=l-yt;O.css({left:-o,top:-n})}q=-(s-It)*(1/(e.thumb_image_width/e.source_image_width)),L=-(l-yt)*(1/(e.thumb_image_height/e.source_image_height)),q<Jt&&(q=Jt),L<Kt&&(L=Kt),e.zoom_easing?(clearTimeout(T),Xt()):(k&&E.css({left:q,top:L}),J.css({left:q,top:L}))}),(x>1||!e.smallthumb_hide_single)&&(P.click(function(){var e=t(this);if(!e.hasClass("etalage_smallthumb_active")&&(!w||y))if(e.hasClass("etalage_smallthumb_first")&&e.prev().length)a("left");else if(e.hasClass("etalage_smallthumb_navtoend"))l();else if(e.hasClass("etalage_smallthumb_last")&&e.next().length)a("right");else if(e.hasClass("etalage_smallthumb_navtostart"))s();else{if(y&&!t(this).next().length)return l(),!0;if(y&&!t(this).prev().length)return s(),!0;Ot(e,!1)}}),e.smallthumb_select_on_hover&&P.mouseenter(function(){t(this).trigger("click")})),e.click_to_zoom?M.click(function(){C=!0,At()}):A.click(function(){var t=Mt.data("anchor");t&&Ft(t)&&(window.location=t)}),x>1&&e.keyboard&&t(document).keydown(function(t){39!==t.keyCode&&"39"!==t.keyCode||(e.right_to_left?Yt():Dt()),37!==t.keyCode&&"37"!==t.keyCode||(e.right_to_left?Dt():Yt())}),t(window).bind("load",function(){M.css({"background-image":"none"}),Y.css({"background-image":"none"}),k&&(k=!1,E.remove())}),j&&Bt()}}),this}}(jQuery);